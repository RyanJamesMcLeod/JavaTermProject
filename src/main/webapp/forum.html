<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Term Forum</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="css/project.css">
        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script>
            $(document).ready(function () {
                var newChannelShow = 'false';
                
                var getForum = function () {
                    $.ajax({
                        url: "./r/forum",
                        method: "get",
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            $.getJSON("./r/forum", function (data) {
                                $('#forum').html('');
                                var content = '';
                                content += "<table><thead><tr><th>User</th><th>Post</th><th>Information</th></tr></thead><tbody>";
                                for (var i = 0; i < data.length; i++){
                                    content += "<tr><td>" + data[i].username + "</br>" + data[i].date + "</td><td>" + data[i].information + "</td><td>Edit/Delete</td></tr>";
                                }
                                content += "</tbody></table>";
                                    $('#forum').append(content);
                            });
                        },
                        error: function (jq, status, thrown) {
                            alert(jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                getForum();
                var getChannel = function () {
                    $.ajax({
                        url: "./r/forum/channels",
                        method: "get",
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            $.getJSON("./r/forum/channels", function (data) {
                                $('#select').empty();
                                for (var i = 0; i < data.length; i++){
                                    $('#select').append('<option value="' + data[i].channel_name + '">' + data[i].channel_name + '</option>');
                                }
                            });
                        },
                        error: function (jq, status, thrown) {
                            alert(jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                getChannel();
                var logout = function () {
                    window.location.assign("http://termproject-ryanmcleod.rhcloud.com/index.html");
                };
                $('#logout').click(logout);
                var forumPost = function () {
                    $.ajax({
                        url: "./r/forum",
                        method: "post",
                        data: JSON.stringify({
                            "information": $('#text').val()
                        }),
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            getForum();
                        },
                        error: function (jq, status, thrown) {
                            alert (jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                $('#submit').click(forumPost);
       
       $('#newChannel').hide();
          $('#appear').click(function () {
              
              if (newChannelShow === 'false') {
                  $('#newChannel').show();
                  newChannelShow = 'true';
              }
              else {
                  $('#newChannel').hide();
                  newChannelShow = 'false';
              }
          });
          
          var newChannel = function () {
                    $.ajax({
                        url: "./r/forum/newChannel",
                        method: "post",
                        data: JSON.stringify({
                            "channelname": $('#newChannelName').val()
                        }),
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            getForum();
                            getChannel();
                        },
                        error: function (jq, status, thrown) {
                            alert (jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                $('#newChannelConfirm').click(newChannel);
          
          //New channel sending goes here
//                $("channelChange").click(function(){
//                     $('#channelName').text($("#select :selected").text());
//                });
       
            });
        </script>
    </head>
    <body>
        <div>Welcome to the Forums<button id="logout">Logout</button></div>
        <div>Username: <div id="username"></div></div>
        <div>Channel: <select id="select"></select></div>
        <div id="channelname">Test</div>
        <button id="channelChange">Change Channel</button>
        <button id="appear">Want to create your own channel? Click here!</button>
        
        <div id="newChannel">
            <p>Enter the new Channel Name: <input id="newChannelName" /></p>
            <p><button id="newChannelConfirm">Send</button></p>
        </div>
        
        <div>
            <p><textarea id="text"></textarea></p>
            <p><button id="submit">Submit</button></p>
        </div>
        <div id="forum"></div>
    </body>
</html>
