<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Term Forum</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="css/project.css">
        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script>
            $(document).ready(function () {
                var getForum = function () {
                    $.ajax({
                        url: "./r/forum",
                        method: "get",
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            $.getJSON("./r/forum", function (data) {
                                $('#myTable tbody').html('');
                                var content = '';
                                for (var i = 0; i < data.length; i++)
                                    content += '<tr><td>' + data[i].username + '</br>' + data[i].date + '</td><td>' + data[i].information + '</td><td>Edit/Delete</td></tr>';
                                    $('#myTable tbody').append(content);
                            });
                        },
                        error: function (jq, status, thrown) {
                            alert(jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                getForum();
                var getChannel = function () {
                    $.ajax({
                        url: "./r/forum/channels",
                        method: "get",
                        dataType: "json",
                        contentType: 'application/json; charset=UTF-8',
                        success: function () {
                            $.getJSON("./r/forum/channels", function (data) {
                                $('#select').empty();
                                for (var i = 0; i < data.length; i++)
                                    $('#select').append('<option value="' + data[i].channel_name + '">' + data[i].channel_name + '</option>');
                            });
                        },
                        error: function (jq, status, thrown) {
                            alert(jq + "\n" + status + "\n" + thrown);
                        }
                    });
                };
                getChannel();
                var logout = function () {
                    window.location.assign("http://termproject-ryanmcleod.rhcloud.com/index.html");
                };
                $('#logout').click(logout);
                var forumPost = function () {
                    $.ajax({
                  url: "./r/forum",
                  method: "post",
                  data: JSON.stringify({
                        "information": $('#text').val()
                  }),
                  dataType: "json",
                  contentType: 'application/json; charset=UTF-8',
                  success: function () {
                      getForum();
                  },
                  error: function(jq, status, thrown) {
                      alert ("this is where it gets to");
                      //alert (jq + "\n" + status + "\n" + thrown);
                  }
                     });
                };
                $('#submit').click(forumPost);
            });
        </script>
    </head>
    <body>
        <div>Welcome to the Forums<button id="logout">Logout</button></div>
        <div>Username: <div id="username"></div></div>
        <div>Channel: <select id="select"></select></div>
        <div id="channelname"></div>
        <div>
            <p><textarea id="text"></textarea></p>
            <p><button id="submit">Submit</button></p>
        </div>
        <table id="myForum">
            <thead>
                <tr>
                  <th>User</th>
                  <th>Post</th>
                  <th>Options</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>
    </body>
</html>
